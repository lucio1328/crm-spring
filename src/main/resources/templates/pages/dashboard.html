<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard CRM</title>

    <link rel="stylesheet" href="/css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
    <h2>üìä Dashboard CRM</h2>
    <p th:if="${error}" th:text="${error}" class="error-message"></p>
    <br/>

    <!-- Totaux -->
    <div class="totals">
        <div class="card">üë• Clients:
            <span id="totalClients" th:text="${statistiques?.getClients() ?: 'N/A'}"></span>
            <div class="card-footer">Liste Clients <i>‚û°Ô∏è</i></div>
        </div>
        <div class="card">üìÇ Projets:
            <span id="totalProjets" th:text="${statistiques?.getProjets() ?: 'N/A'}"></span>
            <div class="card-footer">Liste Clients <i>‚û°Ô∏è</i></div>
        </div>
        <div class="card">‚úÖ T√¢ches:
            <span id="totalTaches" th:text="${statistiques?.getTaches() ?: 'N/A'}"></span>
            <div class="card-footer">Liste Clients <i>‚û°Ô∏è</i></div>
        </div>
        <div class="card">üìú Offres:
            <span id="totalOffres" th:text="${statistiques?.getOffres() ?: 'N/A'}"></span>
            <div class="card-footer">Liste Clients <i>‚û°Ô∏è</i></div>
        </div>
        <div class="card">üí∞ Factures:
            <span id="totalFactures" th:text="${statistiques?.getFactures() ?: 'N/A'}"></span>
            <div class="card-footer">Liste Clients <i>‚û°Ô∏è</i></div>
        </div>
        <div class="card">üí≥ Paiements:
            <span id="totalPaiements" th:text="${statistiques?.getPaiements() ?: 'N/A'}"></span>
            <div class="card-footer">Liste Clients <i>‚û°Ô∏è</i></div>
        </div>
    </div>
    <br/>

    <!-- Graphiques -->
    <div class="charts-container">
        <div class="chart-box">
            <canvas id="chartClientsProjets"></canvas>
        </div>
        <div class="chart-box">
            <canvas id="chartFacturesPaiements"></canvas>
        </div>
        <div class="chart-box">
            <canvas id="chartFacturesEvolution"></canvas>
        </div>
        <div class="chart-box">
            <canvas id="chartOffresAccepteesRefusees"></canvas>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const data = {
            clients: parseInt(document.getElementById("totalClients").innerText) || 0,
            projets: parseInt(document.getElementById("totalProjets").innerText) || 0,
            taches: parseInt(document.getElementById("totalTaches").innerText) || 0,
            offres: parseInt(document.getElementById("totalOffres").innerText) || 0,
            factures: parseInt(document.getElementById("totalFactures").innerText) || 0,
            paiements: parseInt(document.getElementById("totalPaiements").innerText) || 0
        };

        // Graphique 1 : Clients vs Projets vs T√¢ches
        new Chart(document.getElementById("chartClientsProjets").getContext("2d"), {
            type: "bar",
            data: {
                labels: ["Clients", "Projets", "T√¢ches"],
                datasets: [{
                    label: "Comparaison Clients / Projets / T√¢ches",
                    data: [data.clients, data.projets, data.taches],
                    backgroundColor: ["#007bff", "#28a745", "#dc2d50"]
                }]
            }
        });

        // Graphique 2 : Factures vs Paiements
        new Chart(document.getElementById("chartFacturesPaiements").getContext("2d"), {
            type: "pie",
            data: {
                labels: ["Factures", "Paiements"],
                datasets: [{
                    data: [data.factures, data.paiements],
                    backgroundColor: ["#ffcc00", "#ff4444"]
                }]
            }
        });

        // Graphique 3 : √âvolution des factures et paiements
        new Chart(document.getElementById("chartFacturesEvolution").getContext("2d"), {
            type: "line",
            data: {
                labels: ["Jan", "F√©v", "Mar", "Avr", "Mai", "Juin"],
                datasets: [
                    {
                        label: "Factures",
                        data: [10, 20, 30, 25, 40, 50],
                        borderColor: "#ffcc00",
                        fill: false
                    },
                    {
                        label: "Paiements",
                        data: [5, 15, 25, 20, 35, 45],
                        borderColor: "#ff4444",
                        fill: false
                    }
                ]
            }
        });

        // Graphique 4 : Offres accept√©es vs refus√©es
        new Chart(document.getElementById("chartOffresAccepteesRefusees").getContext("2d"), {
            type: "line",
            data: {
                labels: ["Jan", "F√©v", "Mar", "Avr", "Mai", "Juin"],
                datasets: [
                    {
                        label: "Offres accept√©es",
                        data: [3, 5, 8, 12, 15, 20],
                        borderColor: "#17a2b8",
                        fill: false
                    },
                    {
                        label: "Offres refus√©es",
                        data: [7, 10, 15, 10, 5, 3],
                        borderColor: "#6610f2",
                        fill: false
                    }
                ]
            }
        });

    });
</script>
</body>
</html>
