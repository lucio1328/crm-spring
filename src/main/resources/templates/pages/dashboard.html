<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard CRM</title>

    <link rel="stylesheet" href="/css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
    <h2>ğŸ“Š Dashboard CRM</h2>
    <p th:if="${error}" th:text="${error}" class="error-message"></p>
    <br/>

    <!-- Totaux -->
    <div class="totals">
        <div class="card">ğŸ‘¥ Clients:
            <span id="totalClients" th:text="${statistiques?.getClients() ?: 'N/A'}"></span>
            <a th:href="@{/details/clients}" class="card-footer">Voir dÃ©tails <i>â¡ï¸</i></a>
        </div>
        <div class="card">ğŸ“‚ Projets:
            <span id="totalProjets" th:text="${statistiques?.getProjets() ?: 'N/A'}"></span>
            <a th:href="@{/details/projets}" class="card-footer">Voir dÃ©tails <i>â¡ï¸</i></a>
        </div>
        <div class="card">âœ… TÃ¢ches:
            <span id="totalTaches" th:text="${statistiques?.getTaches() ?: 'N/A'}"></span>
            <a th:href="@{/details/taches}" class="card-footer">Voir dÃ©tails <i>â¡ï¸</i></a>
        </div>
        <div class="card">ğŸ“œ Offres:
            <span id="totalOffres" th:text="${statistiques?.getOffres() ?: 'N/A'}"></span>
            <a th:href="@{/details/offres}" class="card-footer">Voir dÃ©tails <i>â¡ï¸</i></a>
        </div>
        <div class="card">ğŸ’° Factures:
            <span id="totalFactures" th:text="${statistiques?.getFactures() ?: 'N/A'}"></span>
            <a th:href="@{/details/factures}" class="card-footer">Voir dÃ©tails <i>â¡ï¸</i></a>
        </div>
        <div class="card">ğŸ’³ Paiements:
            <span id="totalPaiements" th:text="${statistiques?.getPaiements() ?: 'N/A'}"></span>
            <a th:href="@{/details/paiements}" class="card-footer">Voir dÃ©tails <i>â¡ï¸</i></a>
        </div>
    </div>
    <br/>
    <!-- Ajout de l'attribut data-revenus -->
<!--    <div id="revenusData" th:data-revenus='${statistiques.getRevenusMensuels()}'></div>-->
<!--    <p th:text="${statistiques.revenusMensuels}"></p>-->

    <!-- Graphiques -->
    <div class="charts-container">
        <div class="chart-box">
            <canvas id="chartClientsProjets"></canvas>
        </div>
        <div class="chart-box">
            <canvas id="chartFacturesPaiements"></canvas>
        </div>
        <div class="chart-box">
            <canvas id="chartFacturesEvolution"></canvas>
        </div>
        <div class="chart-box">
            <canvas id="chartOffresAccepteesRefusees"></canvas>
        </div>
        <div class="chart-box">
            <canvas id="chartRevenuMensuel"></canvas>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const data = {
            clients: parseInt(document.getElementById("totalClients").innerText) || 0,
            projets: parseInt(document.getElementById("totalProjets").innerText) || 0,
            taches: parseInt(document.getElementById("totalTaches").innerText) || 0,
            offres: parseInt(document.getElementById("totalOffres").innerText) || 0,
            factures: parseInt(document.getElementById("totalFactures").innerText) || 0,
            paiements: parseInt(document.getElementById("totalPaiements").innerText) || 0
        };

        // Graphique 1 : Clients vs Projets vs TÃ¢ches
        new Chart(document.getElementById("chartClientsProjets").getContext("2d"), {
            type: "bar",
            data: {
                labels: ["Clients", "Projets", "TÃ¢ches"],
                datasets: [{
                    label: "Comparaison Clients / Projets / TÃ¢ches",
                    data: [data.clients, data.projets, data.taches],
                    backgroundColor: ["#007bff", "#28a745", "#dc2d50"]
                }]
            }
        });

        // Graphique 2 : Factures vs Paiements
        new Chart(document.getElementById("chartFacturesPaiements").getContext("2d"), {
            type: "pie",
            data: {
                labels: ["Factures", "Paiements"],
                datasets: [{
                    data: [data.factures, data.paiements],
                    backgroundColor: ["#ffcc00", "#ff4444"]
                }]
            }
        });

        // Graphique 3 : Ã‰volution des factures et paiements
        new Chart(document.getElementById("chartFacturesEvolution").getContext("2d"), {
            type: "line",
            data: {
                labels: ["Jan", "FÃ©v", "Mar", "Avr", "Mai", "Juin"],
                datasets: [
                    {
                        label: "Factures",
                        data: [10, 20, 30, 25, 40, 50],
                        borderColor: "#ffcc00",
                        fill: false
                    },
                    {
                        label: "Paiements",
                        data: [5, 15, 25, 20, 35, 45],
                        borderColor: "#ff4444",
                        fill: false
                    }
                ]
            }
        });

        // Graphique 4 : Offres acceptÃ©es vs refusÃ©es
        new Chart(document.getElementById("chartOffresAccepteesRefusees").getContext("2d"), {
            type: "line",
            data: {
                labels: ["Jan", "FÃ©v", "Mar", "Avr", "Mai", "Juin"],
                datasets: [
                    {
                        label: "Offres acceptÃ©es",
                        data: [3, 5, 8, 12, 15, 20],
                        borderColor: "#17a2b8",
                        fill: false
                    },
                    {
                        label: "Offres refusÃ©es",
                        data: [7, 10, 15, 10, 5, 3],
                        borderColor: "#6610f2",
                        fill: false
                    }
                ]
            }
        });

        // RÃ©cupÃ©ration des revenus mensuels via l'attribut data-revenus
        // const revenusDataElement = document.getElementById("revenusData");
        // const revenusData = JSON.parse(revenusDataElement.getAttribute("data-revenus") || "[]");
        //
        // // VÃ©rification et transformation des donnÃ©es
        // if (revenusData.length > 0) {
        //     const labelsRevenus = revenusData.map(item => `${item.annee}-${String(item.mois).padStart(2, '0')}`);
        //     const dataRevenus = revenusData.map(item => item.total);
        //
        //     // Graphique 5 : Ã‰volution du revenu mensuel
        //     new Chart(document.getElementById("chartRevenuMensuel").getContext("2d"), {
        //         type: "line",
        //         data: {
        //             labels: labelsRevenus,
        //             datasets: [
        //                 {
        //                     label: "Revenu mensuel (â‚¬)",
        //                     data: dataRevenus,
        //                     borderColor: "#2ecc71",
        //                     backgroundColor: "rgba(46, 204, 113, 0.2)",
        //                     fill: true
        //                 }
        //             ]
        //         }
        //     });
        // } else {
        //     console.warn("Aucune donnÃ©e de revenu mensuel trouvÃ©e.");
        // }

    });
</script>
</body>
</html>
